spring:
  main:
    allow-bean-definition-overriding: true
  # Graceful shutdown: wait for in-flight requests to complete
  lifecycle:
    timeout-per-shutdown-phase: 30s
  application:
    name: honeycomb
  cloud:
    compatibility-verifier:
      enabled: false

server:
  shutdown: graceful

service:
  discovery:
    base-url: "http://localhost"

eureka:
  client:
    service-url:
      defaultZone: "${EUREKA_SERVER:http://localhost:8761/eureka}"
    fetch-registry: true
    register-with-eureka: true
  instance:
    prefer-ip-address: true

cell:
  # Static discovery examples (comma-separated)
  # addresses:
  #   SampleModel: "sample-service:8081,other-service:8082"
  # ports:
  #   SampleModel: "8081,8082"

# Example application properties for shared caller tests
app:
  test-caller: "test-client"

honeycomb:
  # Storage backend for cell items: memory | redis | hibernate
  # storage:
  #   type: hibernate
  #   routing:
  #     enabled: true
  #     per-cell:
  #       SampleModel: redis
  #   hibernate:
  #     enabled: true
  #     url: "postgresql://localhost:5432/honeycomb"
  #     username: "honeycomb"
  #     password: "honeycomb"
  #     dialect: "org.hibernate.dialect.PostgreSQLDialect"
  #     hbm2ddl-auto: "update"
  #     show-sql: false
  #     pool-size: 10
  #     annotation-free: true
  # validation:
  #   enabled: true
  #   schema-dir: "schemas"
  #   fail-on-missing-schema: false
  #   per-cell:
  #     SampleModel: "SampleModel.schema.json"
  # idempotency:
  #   enabled: true
  #   store: "memory"   # memory | redis
  #   header: "Idempotency-Key"
  #   key-prefix: "honeycomb:idempotency"
  #   ttl-seconds: 300
  # Example: per-cell disabled operations
  # Use '*' key for global defaults
  disabled-operations:
    "__all__":
      - delete
    SampleModel:
      - create
  # WebClient timeouts
  webclient:
    connect-timeout-ms: 5000
    response-timeout-ms: 30000
  audit:
    max-entries: 500
  security:
    # require-auth: true
    api-keys:
      enabled: false
      header: "X-API-Key"
      keys:
        admin: "admin-key"
        cell: "cell-key"
      per-cell:
        "*": ["admin-key", "cell-key"]
    # jwt:
    #   enabled: true
    #   issuer-uri: "https://issuer.example.com/"
    #   jwk-set-uri: "https://issuer.example.com/.well-known/jwks.json"
    #   audience: "honeycomb-api"
    #   roles-claim: "roles"
    #   role-prefix: "ROLE_"
    #   scopes-claim: "scp"
    #   scope-prefix: "SCOPE_"
    #   shared-roles-claim: "shared_roles"
    #   shared-role-prefix: "ROLE_"
    #   default-roles: ["ROLE_USER"]
    #   per-cell-roles:
    #     "*": ["ROLE_USER"]
    #     SampleModel: ["ROLE_ADMIN"]
    #   per-cell-operation-roles:
    #     "*":
    #       read: ["ROLE_USER"]
    #       create: ["ROLE_ADMIN"]
    #     SampleModel:
    #       delete: ["ROLE_ADMIN"]
    #   shared-method-roles:
    #     "*": ["ROLE_USER"]
    #     discount: ["ROLE_PRICING"]
    # mtls:
    #   enabled: true
    #   require-client-cert: true
    #   allowed-subjects:
    #     - "CN=honeycomb-client,O=Example Corp,L=NYC,ST=NY,C=US"
  rate-limiter:
    enabled: true
    defaults:
      limit-for-period: 50
      refresh-period: 1s
      timeout: 0ms
    per-cell:
      SampleModel:
        limit-for-period: 100
        refresh-period: 1s
  routing:
    default-policy: "all"
    per-cell-policy:
      "*": "all"
    weights:
      SampleModel:
        "localhost:8081": 1
  autoscale:
    enabled: false
    evaluation-interval: 30s
    scale-up-rps: 5.0
    scale-down-rps: 0.5
    per-cell-enabled:
      "*": true

# Shared invocation: caller header name to set by clients when invoking shared methods
shared:
  caller-header: "X-From-Cell"

# Actuator endpoints
management:
  endpoints:
    web:
      base-path: /honeycomb/actuator
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
  metrics:
    tags:
      application: honeycomb

# OpenAPI / Swagger configuration
springdoc:
  api-docs:
    path: /honeycomb/api-docs
  swagger-ui:
    path: /honeycomb/swagger-ui.html
    operationsSorter: method
  show-actuator: false
